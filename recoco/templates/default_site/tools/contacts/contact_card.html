{% load sass_tags %}
{% load static %}
{% block css %}
    <link href="{% sass_src 'css/tools/contact/contact-card.scss' %}"
          rel="stylesheet"
          type="text/css" />
    <link href="{% sass_src 'css/tools/contact/search-contact-modal.scss' %}"
          rel="stylesheet"
          type="text/css" />
{% endblock css %}
<template x-if="contact">
    <div class="contact-card fr-p-3v bg-white {% if button_actions %}actions{% endif %}"
         data-test-id="contact-card">
        <div class="d-flex">
            <template x-if="contact.first_name">
                <div>
                    <span x-text="contact.first_name"
                          class="same-for-all-text contact-names fr-pr-1v no-wrap"></span>
                </div>
            </template>
            <template x-if="contact.last_name">
                <div>
                    <span x-text="contact.last_name"
                          class="same-for-all-text contact-names fr-pr-1v no-wrap"></span>
                </div>
            </template>
            <template x-if="contact.division">
                <div>
                    <span x-text="contact.division"
                          class="color-3a3a3a text-position long-text-adaptation no-wrap"></span>
                </div>
            </template>
        </div>
        <template x-if="contact.organization.name">
            <div>
                <span x-text="contact.organization.name"
                      class="color-3a3a3a text-organisation"></span>
            </div>
        </template>
        <template x-if="contact.email">
            <div>
                <a :href="'mailto:'+contact.email"
                   class="contact-card__link same-for-all-text text-position">
                    <span class="fr-icon--sm fr-icon-link" x-text="contact.email"></span>
                </a>
            </div>
        </template>
        {% comment %} TODO WIP {% endcomment %}
        <template x-if="!contact.email">
            <div></div>
        </template>
        <template x-if="contact.phone_no">
            <div>
                <a :href="'tel:'+contact.phone_no"
                   class="contact-card__link same-for-all-text text-position">
                    <span class="fr-icon--sm fr-icon-phone-line" x-text="contact.phone_no"></span>
                </a>
            </div>
        </template>
        <template x-if="contact.mobile_no">
            <div>
                <a :href="'tel:'+contact.mobile_no"
                   class="contact-card__link same-for-all-text text-position">
                    <span class="fr-icon--sm fr-icon-phone-line" x-text="contact.mobile_no"></span>
                </a>
            </div>
        </template>
        <template x-if="contact.modified">
            <div class="contact-card__updated-at">
                <span class="same-for-all-text text-date">mis à jour le</span>
                <span class="same-for-all-text text-date"
                      x-text="contact.modified.split('T')[0]"></span>
            </div>
        </template>
        <template x-if="contact.created && !contact.modified">
            <div class="contact-card__updated-at">
                <span class="same-for-all-text text-date">mis à jour le</span>
                <span class="same-for-all-text text-date"
                      x-text="contact.created.split('T')[0]"></span>
            </div>
        </template>
        {% if button_actions %}
            <div class="button__actions">
                <a class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm fr-icon-pencil-line button__actions-edit"
                   :href="`/addressbook/contact/${contact.id}/update/`">Éditer le contact</a>
                <div x-data="{ openDeleteContact: false }"
                     @click.outside="openDeleteContact = false"
                     class="position-relative">
                    <button class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm fr-icon-delete-line button__actions-delete"
                            @click="openDeleteContact = !openDeleteContact">Supprimer le contact</button>
                    <ul x-show="openDeleteContact"
                        :class="{'openDeleteContact':open}"
                        class="modal__confirm-delete positioning-dropdown">
                        <li class="modal__header">
                            Supprimer un contact
                            <button class="notification__icon"
                                    title="Fermer le menu"
                                    @click="openDeleteContact = false">
                                <svg class="bi fr-mr-1v" width="16" height="16" fill="currentColor">
                                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#x-lg" />
                                </svg>
                            </button>
                        </li>
                        <li>
                            <hr class="dropdown-divider fr-pb-0">
                        </li>
                        <li class="modal__body">
                            <p class="modal__text">Êtes-vous sûr de vouloir supprimer le contact suivant :</p>
                            <div class="contact__resume">
                                <span x-text="contact.first_name"
                                      class="same-for-all-text contact-names fr-pr-1v no-wrap"></span>
                                <span x-text="contact.last_name"
                                      class="same-for-all-text contact-names fr-pr-1v no-wrap"></span>
                                <span x-text="contact.division"
                                      class="color-3a3a3a text-position long-text-adaptation no-wrap"></span>
                                <span x-text="contact.organization.name"
                                      class="color-3a3a3a text-organisation"></span>
                            </div>
                        </li>
                        <li>
                            <hr class="dropdown-divider fr-pb-0">
                        </li>
                        <li class="modal__footer d-inline-flex gap-1">
                            <button class="modal__footer-cancel" @click="openDeleteContact = false">Annuler</button>
                            <button class="modal__footer-confirm">Confirmer la suppression</button>
                        </li>
                    </ul>
                </div>
            </div>
        {% endif %}
    </div>
</template>
