{% extends "base.html" %}
{% load django_vite %}
{% block js %}
    {% vite_asset 'js/styles/create-resources.css.js' %}
    {% vite_asset 'js/components/Resources/CreateResource.js' %}
{% endblock js %}
{% block title %}
    Créer une nouvelle fiche-ressource {{ block.super }}
{% endblock title %}
{% block og_title %}
    Créer une nouvelle fiche-ressource {{ block.super }}
{% endblock og_title %}
{% block content %}
    {{ categories|json_script:"categoriesArray" }}
    <!-- Admin navigation -->
    {% include "crm/fragments/navigation.html" with resources=True %}
    <!-- Breadcrumb -->
    <div x-data="{ breadcrumbs: { links: [{url: '{% url 'crm-site-dashboard' %}', title: 'Admin'}, {url: '{% url 'resources-resource-search' %}', title: 'Ressources'}], current: 'Création de fiche ressource' } }"
         class="fr-p-0">{% include "tools/breadcrumb.html" %}</div>
    <!-- Form -->
    <div x-data="CreateResource()"
         class="fr-container--fluid create-resources">
        <div class="d-flex justify-content-between">
            <h2 class="create-resources__title text-modal-main-msg">Création de fiche ressource</h2>
            <div>
                <button role="button" class="fr-btn fr-btn--tertiary fr-btn--sm fr-mr-1w">Prévisualiser</button>
                <button role="submit"
                        class="fr-btn fr-btn--primary fr-btn--sm fr-mr-1w"
                        @click="onSubmit">Sauvegarder</button>
            </div>
        </div>
        <div class="fr-grid-row">
            <!-- Column 1 -->
            <div class="fr-col-8 fr-col-md-8 fr-col-sm-12 fr-pr-4w">
                <!-- Title -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_title">Titre</label>
                    <input type="text"
                           name="title"
                           class="fr-input"
                           id="id_title"
                           required
                           x-model="newRessourcePayload.title">
                </div>
                <!-- Subtitle -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_subtitle">Sous-titre</label>
                    <input type="text"
                           name="subtitle"
                           class="fr-input"
                           id="id_subtitle"
                           required
                           x-model="newRessourcePayload.subtitle">
                </div>
                <!-- Summary -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_summary">Résumé</label>
                    <input type="text"
                           name="summary"
                           class="fr-input"
                           id="id_summary"
                           required
                           x-model="newRessourcePayload.summary">
                </div>
                <!-- Content with tiptap editor -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_content">Contenu</label>
                    {% include "tools/editor.html" with model="newRessourcePayload.content" input_name="content" initial_content="" input_required=True can_add_reco=False can_attach_files=False can_attach_contact=False show_send_button=False can_compress_editor=False %}
                </div>
            </div>
            <!-- Column 2 -->
            <div class="fr-col-4 fr-col-md-4 fr-col-sm-12 ">
                <!-- Status select -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_summary">Statut de publication</label>
                    <div class="d-flex">
                        <button type="button"
                                class="fr-btn w-50 justify-content-center"
                                :class="newRessourcePayload.status !== 'DRAFT' ? 'fr-btn--secondary' : ''"
                                @click="newRessourcePayload.status = 'DRAFT'">Brouillon</button>
                        <button type="button"
                                class="fr-btn w-50 justify-content-center"
                                :class="newRessourcePayload.status !== 'PUBLISHED' ? 'fr-btn--secondary' : ''"
                                @click="newRessourcePayload.status = 'PUBLISHED'">Publié</button>
                    </div>
                </div>
                <!-- Category select -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_category">Catégorie</label>
                    <select name="category"
                            id="id_category"
                            class="fr-select"
                            required
                            valueAsNumber
                            x-model="newRessourcePayload.category">
                        <option value="" selected disabled>Sélectionner une catégorie</option>
                        {% for category in categories %}<option value="{{ category.id }}">{{ category.name }}</option>{% endfor %}
                    </select>
                </div>
                <!-- Keywords multi-select -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_keywords">Mots-clés</label>
                    {% include "tools/multi_select.html" %}
                </div>
                <!-- Carrier structure -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_carrier_structure">Structure porteuse</label>
                    <input type="text"
                           name="carrier_structure"
                           class="fr-input"
                           id="id_carrier_structure"
                           required>
                </div>
                <!-- Departments/regions multiple select -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_departments">Départements/Régions</label>
                    <div x-data="{objectsToSelect: departments}">
                        {% include "tools/contacts/multi_select.html" with placeholder="Sélectionnez vos départements" label="Territoire" %}
                    </div>
                </div>
                <!-- Expires on date picker -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_expires_on">Date d'expiration</label>
                    <input type="date"
                           name="expires_on"
                           class="fr-input"
                           id="id_expires_on"
                           required>
                </div>
                <!-- Contacts component (multiple) -->
                <div class="fr-input-group">
                    <label class="fr-label text-modal-main-msg" for="id_contacts">Contacts</label>
                    {% comment %} {% include "tools/contacts_component.html" with input_name="contacts" multiple=True %} {% endcomment %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
