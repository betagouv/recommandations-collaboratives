{% comment %}
Parameter Django:
    - node :
    {   'data':
            {
                'recommendation_id': 4242,
                'text': 'task text'
            },
        'position': 1,
        'type': 'recommendation'
    }
    - posted_by : user object
Parameter Alpine:
    - recommendation : recommendation object
{% endcomment %}
<template x-if="tasks.length > 0">
    <div x-data='{recommendation: null}'
         x-init="recommendation = getRecommendationById(node.recommendation_id)"
         class="task-item rounded-3 fr-my-2v">
        <template x-if="recommendation">
            <div>
                <template x-if="recommendation.resource">
                    <div>
                        <p x-html="renderMarkdown(recommendation.content)"></p>
                        <div class="task-item__resource"
                             :class="{'task-item__resource--bordered': !recommendation.visited}">
                            <a :href="recommendation?.resource?.web_url"
                               class="stretched-link"
                               target="_blank"
                               :title="`ouvrir la fiche ressource - nouvel onglet`"
                               @click="await onClickRessourceConsummeNotification(recommendation, element)">
                                <template x-if="!recommendation.visited">
                                    <span class="badge text-white task-item__resource-badge"
                                          x-text="!$store.djangoData.isAdvisor ? 'Nouveau' : 'Non lu par le demandeur' "></span>
                                </template>
                                <template x-if="recommendation.topic">
                                    <div class="task-item__topic"
                                         :style="{ '--color-topic': stringToColor(recommendation.topic?.name) }">
                                        <span class="task-item__topic-icon"></span>
                                        <p class="task-item__topic-name fr-mb-0"
                                           x-text="recommendation.topic?.name"></p>
                                    </div>
                                </template>
                                <h4 class="fr-link" x-text="recommendation.intent"></h4>
                                <template x-if="recommendation.resource.support_orga">
                                    <p class="task-item__resource-orga fr-mt-1v fr-mb-0">
                                        <span class="fr-icon fr-icon--xs fr-icon-government-line"></span> <span x-text="recommendation.resource.support_orga"></span>
                                    </p>
                                </template>
                                <p class="task-item__resource-subtitle fr-mt-1w fr-mb-0"
                                   x-text="recommendation.resource.subtitle"></p>
                                <div class="d-flex justify-content-between">
                                    {% include "conversations/messages/fragments/tasks_status_buttons_js.html" %}
                                    <button class="fr-btn fr-btn--sm fr-btn--primary fr-mt-1w">Consulter</button>
                                </div>
                            </a>
                        </div>
                    </div>
                </template>
                <template x-if="!recommendation.resource">
                    <div>
                        <div class="task-item__resource"
                             :class="{'task-item__resource--bordered': !recommendation.visited}">
                            <template x-if="!recommendation.visited">
                                <span class="badge text-white task-item__resource-badge"
                                      x-text="!$store.djangoData.isAdvisor ? 'Nouveau' : 'Non lu par le demandeur' "></span>
                            </template>
                            <template x-if="recommendation.topic">
                                <div class="task-item__topic"
                                     :style="{ '--color-topic': stringToColor(recommendation.topic?.name) }">
                                    <span class="task-item__topic-icon"></span>
                                    <p class="task-item__topic-name fr-mb-0"
                                       x-text="recommendation.topic?.name"></p>
                                </div>
                            </template>
                            <h4 x-text="recommendation.intent"></h4>
                            <div class="task-item__content task-item__content-ellipsis"
                                 x-html="renderMarkdown(recommendation.content)"></div>
                            {% include "conversations/messages/fragments/tasks_status_buttons_js.html" %}
                        </div>
                    </div>
                </template>
            </div>
        </template>
    </div>
</template>
