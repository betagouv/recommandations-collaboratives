{% load projects_extra %}
<div class="fr-p-5v flex-grow-1"
     id="conversation-new-container"
     hx-boost="true">
    {% if not topic_list %}
        {% regroup feed by topic as topic_list %}
    {% endif %}
    <!-- Message stream -->
    {% for topic in topic_list %}
        {% count_has_notifications topic.list as new_message_count %}
        <div class="conversation-new__container-topic"
             data-type-element="feed-element-item"
             data-topic='{{ topic.grouper|default:"general"|slugify }}'>
            {% for element in topic.list %}
                {% if element.notifications %}
                    <div class="notification-limit"
                         x-ref="scrollLine_{{ topic.grouper|default:"general"|slugify }}">
                        <div class="notification-limit__line"></div>
                        <p class="notification-limit__message-number fr-mx-2w">
                            {{ new_message_count }} message{{ new_message_count|length|pluralize }} non lu{{ new_message_count|length|pluralize }}
                        </p>
                        <div class="notification-limit__line"></div>
                    </div>
                {% endif %}
                {% ifchanged element.timestamp|date %}
                    <p class="conversation-new__date">{{ element.timestamp|date }}</p>
                {% endifchanged %}
                {% if element.type == "activity" %}
                    <!-- Type Activity  -->
                    {% include "projects/project/fragments/conversations_new/message_type/type_activity_item.html" %}
                {% elif element.type == "reco" %}
                    <!-- Type Reco + message -->
                    {% include "projects/project/fragments/conversations_new/message_type/type_task_message_item.html" %}
                {% elif element.type == "followup" %}
                    <!-- Type followup -->
                    {% include "projects/project/fragments/conversations_new/message_type/type_followup_item.html" %}
                {% elif element.type == "posting" %}
                    <!-- Type message -->
                    {% include "projects/project/fragments/conversations_new/message_type/type_posting_item.html" %}
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
</div>
{% if topic_list|length == 0 %}
    <div class="feed-element-item fr-px-5v fr-mb-5v">
        {% include "projects/project/fragments/conversations_new/message_type/empty_message_list.html" %}
    </div>
{% endif %}
