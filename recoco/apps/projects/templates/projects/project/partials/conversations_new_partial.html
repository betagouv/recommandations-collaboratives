{% load projects_extra %}
<div class="conversation-new__container-feed fr-p-3v flex-grow-1"
     id="conversation-new-container">
    {% if not topic_list %}
        {% regroup feed by topic as topic_list %}
    {% endif %}
    {% comment %}
    ****************************************
    ************** NEW STREAM **************
    ****************************************
    {% endcomment %}
    <!-- Loop through all messages -->
    <div class="conversation-new__container-topic">
        {% comment %} <template x-for="message in feed.messages">{% endcomment %}
            {% comment %} TODO: add message date by block {% endcomment %}
            <!-- Loop through one message node  -->
            {% comment %} {% ifchanged message.created|date %}
                <p class="conversation-new__date">{{ message.created|date }}</p>
            {% endifchanged %} {% endcomment %}
            {% comment %} {% include "conversations/messages/message_item.html" %}
        </template> {% endcomment %}
        <template x-for="element in feed.elements">
            <div>
                <template x-if="element.type == 'message'">
                    {% include "conversations/messages/message_item.html" %}
                </template>
                <template x-if="element.type == 'activity'">
                    {% include "projects/project/fragments/conversations_new/message_type/type_followup_item.html" with element="node" %}
                </template>
            </div>
        </template>
        {% comment %} {% for message in feed.messages %}
            <!-- Loop through one message node  -->
            {% ifchanged message.created|date %}
                <p class="conversation-new__date">{{ message.created|date }}</p>
            {% endifchanged %}
            {% include "conversations/messages/message_item.html" %}
        {% endfor %} {% endcomment %}
    </div>
    {% comment %}
    ****************************************
    ************** NEW STREAM **************
    ****************************************
    {% endcomment %}
</div>
<template x-if="feed.messages.length == 0">
    <div class="feed-element-item fr-px-3v fr-mb-3v">
        {% include "projects/project/fragments/conversations_new/message_type/empty_message_list.html" %}
    </div>
</template>
