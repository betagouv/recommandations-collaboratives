{% extends "projects/project/list.html" %}
{% load django_vite %}
{% load static %}
{% load sass_tags %}
{% block title %}
    Carte des dossiers {{ block.super }}
{% endblock title %}
{% block og_title %}
    Carte des dossiers {{ block.super }}
{% endblock og_title %}
{% block js %}
    {% vite_asset 'js/apps/advisorDashboard.js' %}
    {% vite_asset 'js/apps/tutorial.js' %}
    {% vite_asset 'js/apps/boardProjects.js' %}
{% endblock js %}
{% block css %}
    <link href="{% sass_src 'projects/css/segmented_ctrl.scss' %}"
          rel="stylesheet"
          type="text/css">
    <link href="{% sass_src 'projects/css/kanban.scss' %}"
          rel="stylesheet"
          type="text/css">
{% endblock css %}
{% block project_list_content %}
    {{ departments|json_script:"departmentsArray" }}
    {{ regions|json_script:"regionsArray" }}
    <div class="col-12 fr-mx-auto font-marianne">
        <div x-data="PersonalAdvisorDashboard({{ request.site.id }}, departmentsArray, regionsArray)"
             x-init='getData("{{ request.user }}");'
             @selected-departments="saveSelectedDepartment($event)">
            <div class="kanban-header topbar d-flex justify-content-between align-items-center fr-p-2v">
                <div class="kanban-header__view-selector fs-5 fr-mr-6v">
                    {% include "projects/project/fragments/navigation/display_select.html" %}
                </div>
                <div x-data="Tutorial('time-filter-tutorial-on-kanban')"
                     class="kanban-header__middle-part">
                    <div class="kanban-header__searchbar position-relative">
                        {% include "projects/project/fragments/search_bar.html" with action_search="onSearch" x_model="searchText" placeholder="Rechercher commune, #tag, nom du dossier..." %}
                    </div>
                    <div class="kanban-header__lastactivity-filter fr-select-group d-flex fr-m-0 fr-mr-6v align-items-center"
                         id="kanban-time-filter">
                        <label class="fr-label no-wrap fr-mr-1v"
                               for="select-filter-project-duration">Dossiers actifs depuis :</label>
                        <select class="fr-select fr-m-0"
                                name="select-filter-project-duration"
                                x-ref="selectFilterProjectDuration"
                                x-model="filterProjectLastActivity"
                                @change='onLastActivityChange'>
                            <option value="30">1 mois</option>
                            <option value="90">3 mois</option>
                            <option value="180">6 mois</option>
                            <option value="365">1 an</option>
                            <option value="1460">Plus</option>
                        </select>
                    </div>
                    <div class="kanban-header__my-projects-toggle">
                        {% include "projects/project/fragments/only_my_projects_toggle.html" %}
                    </div>
                    <div class="kanban-header__region-filter">
                        {% include "projects/project/fragments/departments_selector.html" with label="Projets de mon territoire" filter_by_regions=True zone_objects="regions" select_all=True %}
                    </div>
                </div>
                <div class="kanban-header__toolbar">{% include "projects/project/fragments/list-toolbars.html" %}</div>
            </div>
            <div class="d-flex align-items-start fr-pt-3w">
                <div class="personal-dashboard-container-inner w-100">
                    {% include "projects/project/fragments/personal_dashboard/personal_dashboard_map.html" %}
                </div>
            </div>
            <div>
                <span class="fr-mb-2w">Légende :</span>
                <ul class="fr-ml-2w">
                    <li>jaune : dossiers non consultés</li>
                    <li>noir : dossiers déjà consultés</li>
                </ul>
            </div>
        </div>
    </div>
{% endblock project_list_content %}
