{% load survey %}
{% load static %}
{% load sass_tags %}

{% block css %}
<link href="{% sass_src 'survey/css/survey.scss' %}" rel="stylesheet" type="text/css">
{% endblock %}



<div class="card text-white" style="background: {{ question_set.color|default:'grey' }};">
    <div class="card-body mt-2 ms-2">
        <div style="border-left: 5px solid white; border-radius: 2px; padding-left: 20px;">
            <div class="mb-0">
                {% if question_set.icon %}
                <svg class="bi d-inline me-1" width="16" height="16">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#{{ question_set.icon }}"/>
                </svg>
                {% endif %}
                <h5 class="align-middle d-inline card-title text-uppercase mb-0" style="line-height: 120%; letter-spacing: 0.2em;">{{ question_set.heading }}</h5>
            </div>
            {% if answers %}
            <progress class="mb-0" max="100" value="{% question_set_completion answers.0.session answers.0.question.question_set %}"></progress>
            <h6>{% question_set_completion answers.0.session question_set %}%</h6>
            {% else %}
            <h6 class="mt-2">{{ question_set.questions.count }} question{{ question_set.questions.count|pluralize }}</h6>
            {% endif %}
            <p class="card-text">
                <ul class="list-unstyled">
                    {{ question_set_completion }}

                    {% for answer in answers %}
                    <li class="mb-2">
                        {% lookup_choices_from_answer answer as choices %}

                        {% if show_question or not choices %}
                        <div>
                            <a class="text-white text-decoration-none link-edit" href="{% url 'survey-question-details' session.id answer.question.id %}">
                                <h6 class="m-0 d-inline align-middle">{{ answer.question.text }}</h6>
                                &nbsp;
                                <svg class="bi me-1 d-inline align-middle" width="12" height="12" fill="currentColor">
                                    <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#pencil"/>
                                </svg>
                            </a>
                        </div>
                        {% endif %}


                        {% if show_answers or show_conclusion %}
                        <ul class="list-unstyled">
                            {% if not show_question %}
                            <a class="link-edit text-white text-decoration-none" href="{% url 'survey-question-details' session.id answer.question.id %}">
                                {% endif %}
                            {% for choice in choices %}
                            {% if show_answers %}
                                <li>
                                    {{ choice.text }}
                                    &nbsp;
                                    <svg class="bi me-1 d-inline align-middle" width="12" height="12" fill="currentColor">
                                        <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#pencil"/>
                                    </svg>
                                </li>
                            {% endif %}
                            {% if show_conclusion  %}
                                <li class="">
                                    {{ choice.conclusion|default:choice.text }}
                                    &nbsp;
                                    <svg class="bi me-1 d-inline align-middle" width="12" height="12" fill="currentColor">
                                        <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#pencil"/>
                                    </svg>
                                </li>
                            {% endif %}
                            {% endfor %}
                            {% if not show_question %}
                            </a>
                            {% endif %}
                        </ul>
                        {% endif %}


                    {% if show_comment and answer.comment or not choices %}
                    <div>
                        <svg class="bi me-1 align-middle" width="16" height="16" fill="currentColor">
                            <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#chat"/>
                        </svg>
                        <span class="align-middle">"<em>{{ answer.comment }}</em>"</span>
                    </div>
                    {% endif %}

                    {% if show_tags and answer.tags %}
                    <div>
                        <svg class="bi me-1 align-middle" width="16" height="16" fill="currentColor">
                            <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#tags"/>
                        </svg>
                        {% for tag in answer.tags %}
                        <span class="badge bg-dark rounded-pill">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    </li>
                    {% endfor %}
                </ul>
            </p>
        </div>
    </div>
</div>
