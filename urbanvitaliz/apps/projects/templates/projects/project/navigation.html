{% load static %}
{% load sass_tags %}
{% load guardian_tags %}
{% block css %}
    <link href="{% sass_src 'home/css/dsfr/marianne.css' %}"
          rel="stylesheet"
          type="text/css">
    <link href="{% sass_src 'projects/css/project_navigation.css' %}"
          rel="stylesheet"
          type="text/css">
{% endblock %}
{% get_obj_perms request.user for request.site as "user_site_perms" %}
{% get_obj_perms request.user for project as "user_project_perms" %}

<ul class="project-navigation d-flex align-items-center"
    style="font-family: 'Marianne', arial, sans-serif;
           padding: 0">
    {% if "list_projects" in user_site_perms or "view_project" in user_project_perms %}
        <li>
            <a class="{% if overview %} active{% endif %}"
               href="{% url 'projects-project-detail-overview' project.pk %}">
                Présentation
            </a>
        </li>
    {% endif %}
    {% if "list_projects" in user_site_perms or "view_surveys" in user_project_perms %}
        <li class="position-relative survey">
            <a class="text-nowrap {% if state_of_play %} active{% endif %}"
               href="{% url 'projects-project-detail-knowledge' project.pk %}">
                <p>État des lieux</p>
                <div class="survey-completion">
                    <div class="survey-completion-progress-bar-container">
                        <i class="survey-completion-progress-bar"
                           style="width: {{ active_project_survey_session.completion }}%;
                                  {% if active_project_survey_session.completion >= 90 %}background-color:#5ec495{% else %}background-color:#f58188{% endif %}"></i>
                    </div>
                    <span class="survey-completion-number">{{ active_project_survey_session.completion }}%</span>
                </div>
            </a>
        </li>
    {% endif %}
    <li>
        {% with "Recommandations" as label %}
            {% if "list_projects" in user_site_perms or "view_tasks" in user_project_perms %}
                <a class="{% if recommandations %} active{% endif %} align-items-center"
                   href="{% url 'projects-project-detail-actions' project.pk %}">
                    {% if active_project_action_notifications_count %}
                        <span class="has-notification">{{ active_project_action_notifications_count }}</span>
                    {% endif %}
                    <span>{{ label }}</span>
                </a>
            {% else %}
                <a class="disabled align-items-center" href="#">
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                    <span>{{ label }}</span>
                </a>
            {% endif %}
        {% endwith %}
    </li>
    <li>
        {% with "Conversation" as label %}
            {% if "view_public_notes" in user_project_perms or "use_public_notes" in user_project_perms %}
                <a class="{% if conversation %} active{% endif %} align-items-center"
                   href="{% url 'projects-project-detail-conversations' project.pk %}">
                    {% if active_project_conversation_notifications_count %}
                        <span class="has-notification">{{ active_project_conversation_notifications_count }}</span>
                    {% endif %}
                    <span>{{ label }}</span>
                </a>
            {% else %}
                <a class="disabled align-items-center" href="#">
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                    <span>{{ label }}</span>
                </a>
            {% endif %}
        {% endwith %}
    </li>
    <li>
        {% with "Fichiers et liens" as label %}
            {% if 'manage_documents' in user_project_perms %}
                <a class="{% if files_links %}active{% endif %} align-items-center"
                   href="{% url 'projects-project-detail-documents' project.pk %}">
                    {% if active_project_document_notifications_count %}
                        <span class="has-notification">{{ active_project_document_notifications_count }}</span>
                    {% endif %}
                    <span>{{ label }}</span>
                </a>
            {% else %}
                <a class="disabled align-items-center" href="#">
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                    <span>{{ label }}</span>
                </a>
            {% endif %}
        {% endwith %}
    </li>
    <li>
        {% with "Espace conseillers" as label %}
            {% if 'view_private_notes' in user_project_perms or 'use_private_notes' in user_project_perms %}
                <a class="{% if internal_followup %}active{% endif %} align-items-center"
                   href="{% url 'projects-project-detail-internal-followup' project.pk %}">
                    {% if active_project_private_conversation_notifications_count %}
                        <span class="has-notification">{{ active_project_private_conversation_notifications_count }}</span>
                    {% endif %}
                    <span>{{ label }}</span>
                </a>
            {% else %}
                <a class="disabled align-items-center" href="#">
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                    <span>{{ label }}</span>
                </a>
            {% endif %}
        {% endwith %}
    </li>
    {% if "invite_collaborators" or "invite_advisors" or "manage_advisors" or "manage_collaborators" or "change_project" in user_site_perms %}
        <li>
            <a class="{% if administration_panel %} active{% endif %} align-items-center"
               href="{% url 'projects-project-administration' project.pk %}">
                <span class="text-nowrap">Administration</span>
            </a>
        </li>
    {% endif %}
</ul>
