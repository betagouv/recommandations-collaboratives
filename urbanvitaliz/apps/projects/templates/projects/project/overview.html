{% extends "projects/project/detail.html" %}

{% load humanize %}
{% load static %}
{% load gravatar %}

{% block title %}
{{ block.super }} > Connaissance
{% endblock %}


{% block project_detail %}

<div class="col-12">
    <div class="row">
        {% if not is_switchtender %}
        {% if can_manage_draft and session and session.next_question and session.completion < 80 %} <div
            class="col box-heading d-flex justify-content-between mb-4 mt-4">

            <div class="flex-grow-1">

                <h3>ComplÃ©tez l'exploration du site !</h3>
                {% if session.completion > 0 %}
                ðŸ”Ž Zoomer sur les bonnes questions Ã  se poser pour dÃ©marrer
                <br />
                ðŸš€ Obtenir des recommandations plus efficaces !
                {% else %}
                ðŸ”Ž Laissez-vous guider vers <strong>les bonnes questions Ã  se poser pour dÃ©marrer</strong> un projet de
                revitalisation.
                <br />
                ðŸš€ En prime, <strong>UrbanVitaliz sera plus efficace</strong> pour vous conseiller !
                {% endif %}
            </div>
            <div class="flex-shrink-1">
                {% if session.completion > 0 %}
                <a href="{% url 'survey-session-start' session.id %}" class="btn btn-primary fw-bold p-2 m-4">
                    <span class="align-middle">Continuer le parcours</span><span class="align-middle"> &#8594;</span>
                </a>
                {% else %}
                <a href="{% url 'survey-project-session' project.id %}" class="btn btn-primary fw-bold p-2 m-4">
                    <span class="align-middle">DÃ©marrer le parcours</span><span class="align-middle"> &#8594;</span>
                </a>
                {% endif %}
            </div>
    </div>
    {% else %}
    <div class="col"></div>
    {% endif %}
    {% else %}
    <div class="col"></div>
    {% endif %}
</div>

{% include 'projects/project/navigation.html' with overview=True %}
<div class="row">
    <div class="col-8">
            {% if can_administrate %}
                {% if project.synopsis %}
                    {% include 'projects/project/fragments/information_card.html' with full_width=True project=project is_editable=True title="Reformulation du besoin" description=project.synopsis updated_on=project.synopsis_on card_user=project.synopsis_by org_name=project.synopsis_by.profile.organization.name %}
                {% else %}
                    <div class="project-card-details me-4 py-4 d-flex flex-column align-items-center justify-content-center">
                        <span style="color:#929292; font-size: 14px;" class="text-uppercase">Aucune reformulation n'a Ã©tÃ© faite pour le moment</span>
                        {% if can_administrate %}
                            <a class="button mt-3" href="{% url "projects-project-synopsis" project.id %}">Reformuler le besoin de la collectivitÃ©</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}
            <div class="mt-4">
                <div class="d-flex w-full flex-wrap">
                    {% include 'projects/project/fragments/information_card.html' with project=project title="Contexte" description=project.description updated_on=project.created_on card_user=project.owner org_name=project.owner.profile.organization.name %}
                    {% if onboarding_response %}
                        {% include 'projects/project/fragments/information_card.html' with project=project onboarding_information=True updated_on=project.created_on card_user=project.owner org_name=project.owner.profile.organization.name %}
                    {% elif project.impediments %}
                        {% include 'projects/project/fragments/information_card.html' with project=project title="DifficultÃ©s rencontrÃ©es" description=project.impediments updated_on=project.created_on card_user=project.owner org_name=project.owner.profile.organization.name %}
                    {% endif %}
                </div>
            </div>
    </div>
    <div class="col-4">
        <h6 style="font-size: 14px;" class="text-uppercase fw-bold d-block mb-3">Informations gÃ©nÃ©rales</h6>
        <div class="d-flex flex-column">
            <span style="font-size: 14px; color:#666666; font-weight: 300;" class="d-block mb-2">RÃ©fÃ©rent collectivitÃ©</span>
            {% include 'projects/project/fragments/user.html' with project=project %}
            <a class="d-flex align-items-center mb-1" style="font-size: 14px; color: #0063CB; text-decoration: none;"
                href="mailto:{{project.owner.email}}">
                <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'Â %}#link-45deg" />
                </svg>&nbsp;
                {{ project.owner.email }}
            </a>
            {% if project.owner.profile.phone_no or project.phone %}
            <span style="font-size: 14px; color: #0063CB;" class="d-flex align-items-center">
                <svg class="bi align-middle" width="15" height="15" fill="currentColor">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'Â %}#telephone" />
                </svg>&nbsp;
                {% if project.owner.profile.phone_no %}
                    {{project.owner.profile.phone_no}}</span>   
                {% else %}
                    {{project.phone}}</span>   
                {% endif %}
            {% endif %}
        </div>
        <div class="d-flex flex-column my-4">
            <span style="font-size: 14px; color:#666666;font-weight: 300;" class="d-block mb-2">Participants</span>
            <ul class="d-flex flex-column list-unstyled">
                {% for switchtender in project.switchtenders.all %}
                        <li>
                            {% include 'projects/project/fragments/user.html' with member=switchtender project=project %}
                        </li>
                {% endfor %}
                {% for member in project.members.all %}
                    {% if forloop.counter0 == 0 %}
                        <li>
                            {% include 'projects/project/fragments/user.html' with member=False project=project %}
                        </li>
                    {% else %}
                        <li>
                            {% include 'projects/project/fragments/user.html' with member=member project=project %}
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <div class="d-block mb-2">
                <a class="{% if project.status == 'DRAFT' %} disabled {% endif %} button d-inline-flex" href="{% url 'projects-access-update' project.id %}">
                    {% if project.status == 'DRAFT' %}
                        <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                            <use xlink:href="{% static 'svg/bootstrap-icons.svg'Â %}#lock-fill" />
                        </svg>&nbsp;
                    {% endif %}
                        <span>Inviter d'autres participants</span>
                </a>
            </div>
        </div>
    </div>
</div>

</div>
{% endblock %}
