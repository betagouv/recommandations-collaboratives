{% load static %}
{% load survey %}

{% block content %}

<div class="row">

    <!-- Actions -->
    <div class="w-100">
        <h2 class="mb-3 d-inline-block">
            <svg class="bi align-middle me-1" width="28" height="28" fill="currentColor">
                <use xlink:href="{% static 'svg/bootstrap-icons.svg'¬†%}#search"/>
            </svg>
            <span class="align-middle">Exploration de votre site</span>
        </h2>
    </div>



    {% if not session %}
    <p class="mb-3 text-secondary">
        L' <strong><em>Exploration</em></strong> permet de regrouper les informations n√©cessaires √† l'√©tude de votre dossier.
        <!-- <span class="text-secondary">Par exemple, il peut s'agir d'une √©tape pour  <q><em> Identifier le propri√©taire </em></q> ou encore <q><em> V√©rifier la pollution des sols </em></q></span>. -->
    </p>


    <div class="bd-callout bd-callout-warning text-white position-relative" style="border-radius: 10px; background: #5DC2B0;">
                    <div class="d-flex justify-content-between w-100">
                        <h4 class="text-left flex-grow">
                            <img src="{% static 'projects/img/analyzing.gif' %}" width="50px">&nbsp;
                            D√©marrer l'exploration !
                        </h4>

                        <a href="{% url 'survey-project-session' project.id %}" class="text-white fw-bolder text-decoration-none stretched-link">
                            <span class="align-middle">D√©marrer</span><span class="fs-2 align-middle"> &#8594;</span>
                        </a>
                    </div>
    </div>
    {% else %}

    <p class="text-secondary">
        {% if project.survey_session  %}

        {% if project.survey_session.next_question %}
        La <strong>pertinence de nos recommandations</strong> est li√©e √† la connaissance que nous avons de votre site.

        N'h√©sitez pas <a href="{% url 'survey-session-start' project.survey_session.id %}">√† continuer le questionnaire</a> !
        {% else %}

        üéâ <strong>Merci</strong> d'avoir r√©pondu √† toutes les questions ! Ceci nous aide √† <strong>mieux cibler vos besoins</strong>.
        {% endif %}
        {% endif %}
    </p>




    <div class="row row-cols-1 row-cols-md-2">
        <!-- Show QS with progress -->
        {% regroup session.answers.all by question.question_set as answer_list %}
        {% for question_set, answers in answer_list %}
        <div class="col">
            {% include 'survey/widgets/qs_summary_card.html' with question_set=question_set answers=answers show_conclusion=1 show_comment=1 %}
        </div>
        {% endfor %}

        <!-- Show other QS not yet started -->
        {%  for question_set in session.survey.question_sets.all %}

        {% question_set_completion session question_set as qs_completion %}
        {% if qs_completion == 0 %}
        <div class="col">
            {% include 'survey/widgets/qs_summary_card.html' with question_set=question_set %}
        </div>
        {% endif %}
        {% endfor %}

    </div>
    {% endif %}
</div>
{% endblock %}
