{% extends "projects/project/detail.html" %}

{% load humanize %}
{% load static %}
{% load survey %}

{% block title %}
{{ block.super }} > Connaissance
{% endblock %}


{% block js %}
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async></script>

</script>
{% endblock %}

{% block project_detail %}

<div class="col-12">

    <div class="row">

        {% if can_manage_draft %}
        {% if session and session.next_question %}
        {% if session.completion < 80 %}
        <div class="col box-heading d-flex justify-content-between mb-4 mt-4">
            <div class="flex-grow-1">

                <h3>ComplÃ©tez l'exploration du site !</h3>
                {% if session.completion > 0 %}
                ðŸ”Ž Zoomer sur les bonnes questions Ã  se poser pour dÃ©marrer
                <br/>
                ðŸš€ Obtenir des recommandations d'action plus efficaces !
                {% else %}
                ðŸ”Ž Laissez-vous guider vers <strong>les bonnes questions Ã  se poser pour dÃ©marrer</strong> un projet de revitalisation.
                <br/>
                ðŸš€ En prime, <strong>UrbanVitaliz sera plus efficace</strong> pour vous conseiller !
                {% endif %}
            </div>
            <div class="flex-shrink-1">
                {% if session.completion > 0 %}
                <a href="{% url 'survey-session-start' session.id %}" class="btn btn-primary fw-bold p-2 m-4">
                    <span class="align-middle">Continuer le parcours</span><span class="align-middle"> &#8594;</span>
                </a>
                {% else %}
                <a href="{% url 'survey-project-session' project.id %}" class="btn btn-primary fw-bold p-2 m-4">
                    <span class="align-middle">DÃ©marrer le parcours</span><span class="align-middle"> &#8594;</span>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endif %}
        {% endif %}
        <div id="project-sidebar" class="col-md-3 h-100">
            {% include "projects/project/fragments/sidebar.html" %}
        </div>

    </div>

    <div class="row g-0" data-masonry='{"percentPosition": true, "transitionDuration": 0 }' >
        <!-- Show QS with progress -->
        {% regroup session.the_answers.all by question.question_set as answer_list %}

        <div class="col-12 col-xl-4 col-md-6 mb-3 p-2">
            <div class="card text-black rounded-3">
            <div class="card-body m-1">
                <h4 class="fw-bold">
                    <h5 class="fw-bolder align-middle d-inline card-title text-uppercase mb-0" style="line-height: 120%; letter-spacing: 0.2em;">Informations gÃ©nÃ©rales</h5>
                                        {{ project.name|title }}
                </h4>
                <p class="card-text">
                    {% include "projects/project/fragments/summary.html" %}
                </p>
            </div>
            </div>
        </div>

        {% for question_set, answers in answer_list %}
        <div class="col-12 col-xl-4 col-md-6 mb-3 p-2">
            {% include 'survey/widgets/qs_summary_card.html' with question_set=question_set can_manage=can_manage_draft answers=answers show_conclusion=1 show_comment=1 %}
        </div>
        {% endfor %}

        <!-- Show other QS not yet started -->
        {%  for question_set in session.survey.question_sets.all %}

        {% question_set_completion session question_set as qs_completion %}
        {% if qs_completion == 0 %}
        <div class="col-12 col-xl-4 col-md-6 mb-3 p-2">
            {% include 'survey/widgets/qs_summary_card.html' with question_set=question_set can_manage=can_manage_draft %}
        </div>
        {% endif %}
        {% endfor %}

    </div>
</div>
{% endblock %}
