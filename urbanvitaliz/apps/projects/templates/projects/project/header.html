{% load static %}
{% load django_vite %}
{% load guardian_tags %}
{% block js %}
    {% vite_asset 'js/apps/projectShare.js' %}
{% endblock %}
{% get_obj_perms request.user for request.site as "user_site_perms" %}
{% get_obj_perms request.user for project as "user_project_perms" %}
{% with request.resolver_match.url_name as url_name %}
    {% block banner %}
        {% if user == project.owner or user.is_staff or 'can_administrate_project' in user_project_perms %}
            {% include 'projects/project/fragments/project_active_status_banner.html' with show_action_button=True %}
        {% else %}
            {% include 'projects/project/fragments/project_active_status_banner.html' %}
        {% endif %}
    {% endblock %}
    <div x-data="ProjectShare"
         class="col-12 d-flex justify-content-between align-items-start">
        <div class=" d-flex flex-column mb-2">
            <div class="d-flex align-items-center">
                <div class="project-link d-flex align-items-center">
                    <span class="fw-bold title-info text-dark me-2 location">{{ project.commune.name }}</span>
                    <span class="text-info-custom text-grey-dark name">{{ project.name }}</span>
                </div>
            </div>
            <div class="d-flex">
                <p class="tiny text-grey-dark">
                    <svg class="bi" width="15" height="15" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#geo-alt-fill" />
                    </svg>
                    {% if project.commune %}
                        {{ project.commune.name }} —   {{ project.commune.postal }}, {{ project.commune.department }} - {{ project.commune.department.region }} - INSEE: {{ project.commune.insee }}
                    </p>
                {% endif %}
            </div>
            {% if "use_project_tags" in user_site_perms %}
                <div class="d-flex justify-content-between">
                    <ul class="d-flex list-unstyled m-0 p-0 flex-wrap mb-3">
                        {% for tag in project.tags.all %}<li class="mx-1 my-1 badge rounded-pill bg-dark">{{ tag }}</li>{% endfor %}
                        <a class="d-flex align-items-center"
                           href="{% url "projects-project-tags" project.id %}">
                            <svg class="bi ms-2 " width="15" height="15" fill="currentColor">
                                <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#pencil-fill" />
                            </svg>
                        </a>
                    </ul>
                </div>
            {% endif %}
        </div>
        <div class="d-flex flex-row-reverse flex-grow-1 ps-2">
            {% include "projects/project/fragments/email_reminder/project_email_reminder.html" %}
        </div>
        <div class="flex-shrink-0 ps-2">
            {% if 'actions' not in url_name and 'conversations' not in url_name and 'internal-followup' not in url_name %}
                <a style="cursor: pointer"
                   @click="openPublicShareModal"
                   data-toggle="modal"
                   data-target="#publicShareModal"
                   class="{% if project.status == 'DRAFT' %} disabled{% endif %} button d-inline-flex align-items-center">
                    {% if project.status == 'DRAFT' %}
                        <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                            <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                        </svg>
                        &nbsp;
                    {% endif %}
                    <span>Partager l'état des lieux</span>
                </a>
            {% endif %}
            {% include "projects/project/fragments/sidebar.html" with disable_can_share=True disable_add_recommendation=True disable_add_recommendation=True disable_administration=True %}
            {% include "projects/project/fragments/share/public_share_modal.html" %}
        </div>
    </div>
{% endwith %}
