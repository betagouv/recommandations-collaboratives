{% extends "projects/project/detail.html" %}

{% load static %}
{% load humanize %}

{% block title %}
{{ block.super }} > Actions
{% endblock %}

{% block project_detail %}

<div class="col-12 mx-auto">

    {% include "projects/project/fragments/reminder_modal.html" %}

    <div class="row">
        <div class="col col-xl-8 col-lg-10">
            {% if is_switchtender %}
            <h2 class="mt-1 mb-4 text-secondary text-uppercase fw-bolder" style="font-size: 12px;">
                <span class="align-middle">Actions proposées à la collectivité</span>
            </h2>
            {% else %}
            <h2 class="mt-1 mb-4 text-secondary text-uppercase fw-bolder" style="font-size: 12px;">
                <span class="align-middle">Mes actions en cours</span>
            </h2>
            {% endif %}

            {% if project.tasks.open.count %}

            <div  id="task-list">
		            {% for task in project.tasks.open %}
                {% include 'projects/project/fragments/action_list_item.html' %}
		            {% endfor %}
            </div>
            {% else %}
            <!-- Empty -->
            {% if is_switchtender %}
            <div class="bg-light p-4 rounded-2">
                <h3 class="fw-light">Pas encore d'actions recommandées à la collectivité ?</h3>
                {% if project.tasks.proposed.count == 0 %}
                <p class="fst-italic fw-light">
                    Soyez la première personne à proposer des actions ou des ressources à la collectivité !
                </p>
                <a href="{% url 'projects-project-create-action' project.id %}" class="btn btn-primary">Émettre une recommandation</a>
                <a href="{% url 'projects-project-detail-knowledge' project.id %}" class="btn btn-secondary">Consulter les détails du projet</a>
                {% endif %}

                {% if can_administrate %}
                <p class="mt-3">
                    <span class="badge bg-warning">Beta feature</span> <a href="{% url 'projects-project-tasks-suggest' project.pk %}">Examiner les actions suggérées automatiquement pour ce dossier</a>
                </p>
                {% endif %}
            </div>
            {% else %}
            <div class="bg-light p-4 rounded-2">
                <h3 class="fw-light">Vous n'avez pas d'actions en cours</h3>
                {% if project.tasks.proposed.count == 0 %}
                <p class="fst-italic fw-light">
                    Des actions vous seront proposées par notre équipe dès que possible.
                </p>
                <p class="fst-italic fw-light">
                    Vous pouvez accélerer les recommandations <span class="fw-bolder">en complétant le questionnaire d'exploration</span>.
                </p>
                <a href="{% url 'survey-project-session' project.id %}" class="btn btn-primary">Compléter le questionnaire d'exploration</a>
                {% else %}
                <p class="fst-italic fw-light">
                    Nos aiguilleuses vous <span class="fw-bolder">recommandent des actions</span>, n'hésitez pas à les consulter et vous les approprier ! Toutes les propositions d'actions se trouvent sur <strong>la colonne de droite</strong>.
                </p>
                {% endif %}
            </div>
            {% endif %}
            {% endif %}


            {% if project.tasks.closed.count %}

            <h2 class="mt-5 mb-4 text-secondary text-uppercase fw-bolder" style="font-size: 12px;">
                <span class="align-middle">Actions terminées</span>
                &nbsp;
                <span class="align-middle badge rounded-pill bg-secondary">{{ project.tasks.closed.count }}</span>
            </h2>

            <div class="accordion" id="task-list">
		            {% for task in project.tasks.closed %}
                {% include 'projects/project/fragments/action_list_item.html' with hide_details=True %}
		            {% endfor %}
            </div>
            {% endif %}

            {% if project.tasks.refused.count %}

            <h2 class="mt-5 mb-4 text-secondary text-uppercase fw-bolder" style="font-size: 12px;">
                <span class="align-middle">Actions refusées</span>
                &nbsp;
                <span class="align-middle badge rounded-pill bg-secondary">{{ project.tasks.refused.count }}</span>
            </h2>

            <div class="accordion" id="task-list">
		            {% for task in project.tasks.refused %}
                {% include 'projects/project/fragments/action_list_item.html' %}
		            {% endfor %}
            </div>
            {% endif %}

        </div>

        <div class="col mx-auto">
            <div class="mb-4">
                {% include "projects/project/fragments/sidebar.html" %}
            </div>

            {% if project.switchtenders.count %}
            <h6 class="mb-2 fw-bolder">Vos aiguilleu·r·se·s</h6>

            <p class="mt-3">
                Bonjour, l'équipe est là pour vous accompagner tout au long de votre parcours.
                N'hésitez pas à prendre contact via les commentaires, nous vous répondrons dès que possible.
            </p>

            {% include "projects/project/fragments/switchtender-list.html" with switchtenders=project.switchtenders.all %}
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}
